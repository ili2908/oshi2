(this["webpackJsonpgraph-project"]=this["webpackJsonpgraph-project"]||[]).push([[0],{19:function(n,e){function t(n){var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}t.keys=function(){return[]},t.resolve=t,n.exports=t,t.id=19},20:function(n,e){},30:function(n,e){},31:function(n,e){},32:function(n,e){},36:function(n,e){},37:function(n,e){},38:function(n,e){},39:function(n,e){},40:function(n,e){},41:function(n,e){},43:function(n,e,t){"use strict";t.r(e);var o,c,i,r=t(7),a=t.n(r),s=t(21),d=t.n(s),u=t(3),h=t(5),l=t.n(h),f=t(12),b=t(14),v=t(13),j=t(0),p=(t(34),t(9)),M=t(8),k=t(4),g=t(2),O=function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;Object(g.a)(this,n),this.identifier=void 0,this.data=void 0,this.identifier=e,this.data=t},y=function n(e,t,o){Object(g.a)(this,n),this.node0=void 0,this.node1=void 0,this.data=void 0,this.node0=e,this.node1=t,this.data=o},x=function(n){Object(p.a)(t,n);var e=Object(M.a)(t);function t(){return Object(g.a)(this,t),e.apply(this,arguments)}return Object(k.a)(t,[{key:"createConnection",value:function(n,e,t){return new y(n,e,t)}}]),t}(function(){function n(){Object(g.a)(this,n),this.nodes={},this.connections={},this.inboundConnections={}}return Object(k.a)(n,[{key:"neighbours",value:function(n){var e=this.connections;if(!(n in e))return[];var t=[];for(var o in e[n])t.push(this.nodes[o]);return t}},{key:"connected",value:function(n,e){var t=this.connections;return n in t&&!!t[n][e]}},{key:"getConnection",value:function(n,e){var t=this.connections;return n in t?t[n][e]:null}},{key:"deleteV",value:function(n){var e=this.connections;n in this.nodes&&(delete this.nodes[n],delete e[n])}},{key:"addV",value:function(n){this.nodes[n.identifier]=n}},{key:"connect",value:function(n,e,t){n in this.nodes&&e in this.nodes&&(this.connections[e]=this.connections[e]||{},this.connections[n]=this.connections[n]||{},this.connections[n][e]=this.createConnection(this.nodes[n],this.nodes[e],t),this.inboundConnections[e]=this.inboundConnections[e]||{},this.inboundConnections[n]=this.inboundConnections[n]||{},this.inboundConnections[e][n]=this.connections[n][e])}},{key:"disconnect",value:function(n,e){var t=this.connections;n in t&&e in t[n]&&(delete this.connections[n][e],delete this.inboundConnections[e][n])}},{key:"contrapt",value:function(n,e){var t=this.connections,o=this.inboundConnections;if(n in t&&e in t[n]){for(var c in this.disconnect(n,e),this.disconnect(e,n),t[e])this.connect(n,c);for(var i in o[e])this.connect(i,n);this.deleteV(e)}}},{key:"GED",value:function(n){return 0}}]),n}()),w=(t(17),t(6),t(11)),C=1e3,m=function(n){Object(p.a)(t,n);var e=Object(M.a)(t);function t(n,o,c,i){var r;return Object(g.a)(this,t),(r=e.call(this,{radius:20,fill:"green",top:o-20,left:n-20,hasBorders:!1,hasControls:!1})).node=new O(C++,{x:n,y:o,n:Object(w.a)(r)}),c.addV(r.node),r.tokens=[],r.centreX=n,r.centreY=o,r.canvas=i,i.add(Object(w.a)(r)),r}return Object(k.a)(t,[{key:"addToken",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;6!=this.tokens.length&&(this.tokens.push({circle:new u.fabric.Circle({radius:5,fill:"rgb(".concat(17%e*30,",").concat(17%(+e+2)*30,",").concat(17%(+e+4)*30,")"),top:10,left:10}),color:e}),this._updateTokens(),this.tokens.forEach((function(e){var t=e.circle;return n.canvas.add(t)})))}},{key:"removeToken",value:function(n){var e=this.tokens.findIndex((function(e){var t=e.color;return n==t}));this.tokens=this.tokens.filter((function(n,t){return t!=e}))}},{key:"_updateTokens",value:function(){var n=this,e=function(n){var e=n.aCoords,t=e.tl,o=e.br;return[(t.x+o.x)/2,(t.y+o.y)/2]}(this),t=Object(j.a)(e,2),o=t[0],c=t[1];this.setCoords(),this.tokens.forEach((function(e,t){var i=e.circle;i.set({left:o-5+10*Math.sin(2*Math.PI*t/n.tokens.length),top:c-5+10*Math.cos(2*Math.PI*t/n.tokens.length)}).setCoords(),n.canvas.bringToFront(i),n.canvas.renderAll()}))}}]),t}(u.fabric.Circle),T=function(){function n(){Object(g.a)(this,n),this.handlers={}}return Object(k.a)(n,[{key:"on",value:function(n,e){var t=this;n.forEach((function(n){t.handlers[n]=e}))}},{key:"pass",value:function(n,e){return this.handlers[n]&&this.handlers[n](e)||this}}]),n}(),N=new x,R=0,S=[],E=function(n,e){var t=S.includes("a")?new u.fabric.Rect({width:40,height:40,fill:"red",top:e-20,left:n-20,hasBorders:!1,hasControls:!1}):new m(n,e,N,o);if(t.isRect=S.includes("a"),t.isRect){var c=new O(R++,{x:n,y:e,node:t});N.addV(c),t.node=c}return t.tokens=[],o.add(t),t},I=function(n,e){var t=Object(j.a)(n,4),c=t[0],i=t[1],r=t[2],a=t[3],s=new u.fabric.Triangle({width:10,height:15,fill:"rgb(".concat(17%e*30,",").concat(17%(+e+2)*30,",").concat(17%(+e+4)*30,")"),left:r,top:a,angle:180*Math.atan((r-c)/(a-i))/Math.PI,hasBorders:!1,hasas:!1,evented:!1,selectable:!1}),d=new u.fabric.Line([c,i,r,a],{stroke:"rgb(".concat(17%e*30,",").concat(17%(+e+2)*30,",").concat(17%(+e+4)*30,")"),hasBorders:!1,hasas:!1,evented:!1,selectable:!1});return d.triangle=s,d.color=e||0,o.add(d),o.add(s),d},q=function(n){var e=n.aCoords,t=e.tl,o=e.br;return[(t.x+o.x)/2,(t.y+o.y)/2]},P=function(){i&&(o.remove(i.triangle),o.remove(i).renderAll()),i=null},A=function(n){return[Math.floor(n.x)-2,Math.floor(n.y)-2]},B=function(n,e,t){var c=e.x1,i=e.x2,r=e.y1,a=e.y2,s=Math.sqrt((i-c)*(i-c)+(a-r)*(a-r))/100*t,d=Math.atan2(a-r,i-c);n.set({top:s*Math.sin(d)-5*Math.cos(d)+r,left:s*Math.cos(d)+5*Math.sin(d)+c}).setCoords(),o.renderAll()},D=["objectNotSelected","objectSelectedNode","objectDragging","ctrlPressed"].reduce((function(n,e){return n[e]=new T,n}),{});D.objectNotSelected.on(["down:nothing","down:node","down:selected"],(function(n){var e=n.pointer,t=n.target;return(c=t)||(c=E(Math.floor(e.x),Math.floor(e.y))),i=I([].concat(Object(v.a)(q(c)),[Math.floor(e.x)-2,Math.floor(e.y)-2]),S.find((function(n){return n>="0"&&n<="9"}))),D.objectSelectedNode})),D.objectSelectedNode.on(["down:nothing"],(function(n){n.target;var e=n.pointer;if(c.isRect&&!S.includes("a")||!c.isRect&&S.includes("a")){var t=E.apply(void 0,Object(v.a)(A(e))),r=q(t),a=Object(j.a)(r,2),s=a[0],d=a[1];i.end=t.node.identifier,i.set({x2:s,y2:d}).setCoords();var u=i.x1,h=i.y1,l=Math.atan2(d-h,s-u);i.triangle.set({left:s+5*Math.sin(l)-(i.isRect?(10*Math.sqrt(2)+15)*Math.cos(l):25*Math.cos(l)),top:d-5*Math.cos(l)-(i.isRect?(10*Math.sqrt(2)+15)*Math.sin(l):25*Math.sin(l)),angle:180*l/Math.PI+90}).setCoords(),N.connect(c.node.identifier,t.node.identifier,{line:i}),o.renderAll(),c=t,i=I([].concat(Object(v.a)(q(c)),[Math.floor(e.x)-2,Math.floor(e.y)-2]),S.find((function(n){return n>="0"&&n<="9"})))}})),D.objectSelectedNode.on(["down:node"],(function(n){var e=n.target;if(console.log(1),c.isRect&&!e.isRect||!c.isRect&&e.isRect){var t=q(e),r=Object(j.a)(t,2),a=r[0],s=r[1],d=e.node.identifier,u=c.node.identifier;if(N.connections[d]&&u in N.connections[d])return P(),o.remove(N.connections[d][u].data.line),o.remove(N.connections[d][u].data.line.triangle),N.disconnect(d,u),D.objectNotSelected;if(N.inboundConnections[d]&&u in N.inboundConnections[d])return P(),D.objectNotSelected;i.end=e.node.identifier,i.set({x2:a,y2:s}).setCoords();var h=i.x1,l=i.y1,f=Math.atan2(s-l,a-h);return i.triangle.set({left:a+5*Math.sin(f)-(i.isRect?(10*Math.sqrt(2)+15)*Math.cos(f):25*Math.cos(f)),top:s-5*Math.cos(f)-(i.isRect?(10*Math.sqrt(2)+15)*Math.sin(f):25*Math.sin(f)),angle:180*f/Math.PI+90}).setCoords(),o.renderAll(),N.connect(c.node.identifier,e.node.identifier,{line:i}),D.objectNotSelected}})),D.objectNotSelected.on(["key:pressed"],(function(n){"q"===n.key&&function(){K.apply(this,arguments)}()})),D.objectSelectedNode.on(["key:pressed"],(function(n){" "===n.key&&c.addToken&&c.addToken(S.find((function(n){return n>="0"&&n<="9"})))})),D.objectSelectedNode.on(["down:selected"],(function(){return P(),D.objectNotSelected})),D.objectSelectedNode.on(["move:mouse"],(function(n){var e=n.pointer,t=A(e),c=Object(j.a)(t,2),r=c[0],a=c[1];i.set({x2:r,y2:a}).setCoords();var s=i.x1,d=i.y1,u=Math.atan2(a-d,r-s);i.triangle.set({left:r+5*Math.sin(u),top:a-5*Math.cos(u),angle:180*u/Math.PI+90}).setCoords(),o.sendToBack(i).renderAll()})),D.objectSelectedNode.on(["move:node"],(function(){return D.objectDragging})),D.objectNotSelected.on(["move:node"],(function(){return D.objectDragging})),D.objectDragging.on(["move:node"],(function(n){var e=n.target,t=n.pointer;P();var c=e.node.identifier;if(e._updateTokens&&e._updateTokens(),o.sendToBack(e),N.connections[c]||N.inboundConnections[c]){var i=A(t),r=Object(j.a)(i,2),a=r[0],s=r[1];Object.entries(Object(b.a)(Object(b.a)({},N.connections[c]),N.inboundConnections[c])).forEach((function(n){var e=Object(j.a)(n,2),t=(e[0],e[1].data.line);t.set(t.end===c?{x2:a,y2:s}:{x1:a,y1:s}).setCoords();var i=t.end===c?t.x1:t.x2,r=t.end===c?t.y1:t.y2,d=Math.atan2(s-r,a-i);t.triangle.set({left:t.end===c?a+5*Math.sin(d)-(t.isRect?(10*Math.sqrt(2)+15)*Math.cos(d-Math):25*Math.cos(d)):i-5*Math.sin(d)+(t.isRect?(10*Math.sqrt(2)+15)*Math.cos(d-Math):25*Math.cos(d)),top:t.end===c?s-5*Math.cos(d)-(t.isRect?(10*Math.sqrt(2)+15)*Math.sin(d):25*Math.sin(d)):r+5*Math.cos(d)+(t.isRect?(10*Math.sqrt(2)+15)*Math.sin(d):25*Math.sin(d)),angle:t.end===c?180*d/Math.PI+90:180*d/Math.PI-90}).setCoords(),o.sendToBack(t),o.sendToBack(t.triangle)})),o.renderAll()}})),D.objectDragging.on(["up"],(function(){var n=c.node.identifier,e=Object(v.a)(q(c)),t=e[0],i=e[1];return N.connections[n]?(Object.entries(Object(b.a)(Object(b.a)({},N.connections[n]),N.inboundConnections[n])).forEach((function(e){var c=Object(j.a)(e,2),r=(c[0],c[1].data.line);r.set(r.end===n?{x2:t,y2:i}:{x1:t,y1:i}).setCoords(),o.sendToBack(r),r.set(r.end===n?{x2:t,y2:i}:{x1:t,y1:i}).setCoords();var a=r.end===n?r.x1:r.x2,s=r.end===n?r.y1:r.y2,d=Math.atan2(i-s,t-a);r.triangle.set({left:r.end===n?t+5*Math.sin(d)-(r.isRect?(10*Math.sqrt(2)+15)*Math.cos(d-Math):25*Math.cos(d)):a-5*Math.sin(d)+(r.isRect?(10*Math.sqrt(2)+15)*Math.cos(d-Math):25*Math.cos(d)),top:r.end===n?i-5*Math.cos(d)-(r.isRect?(10*Math.sqrt(2)+15)*Math.sin(d):25*Math.sin(d)):s+5*Math.cos(d)+(r.isRect?(10*Math.sqrt(2)+15)*Math.sin(d):25*Math.sin(d)),angle:r.end===n?180*d/Math.PI+90:180*d/Math.PI-90}).setCoords(),o.sendToBack(r.triangle)})),c._updateTokens&&c._updateTokens(),o.renderAll(),D.objectNotSelected):D.objectNotSelected}));var _=function(n){var e=n.color,t=new u.fabric.Circle({radius:5,fill:"rgb(".concat(17%e*30,",").concat(17%(+e+2)*30,",").concat(17%(+e+4)*30,")"),top:n.y1,left:n.x1});return o.add(t),t};function V(){var n=[],e={};return Object.entries(N.nodes).filter((function(n){var e=Object(j.a)(n,2);e[0];return!e[1].data.n})).forEach((function(t){var o=Object(j.a)(t,2),c=o[0];o[1];console.log(Object.entries(N.inboundConnections[c])),Object.entries(N.inboundConnections[c]).every((function(n){var t=Object(j.a)(n,2),o=t[0],c=t[1].data.line,i=N.nodes[o].data.n.tokens.filter((function(n){return n.color==c.color}));return e[o]||(e[o]=[0,0,0,0,0,0,0,0,0,0]),i.length-1>=e[o][c.color]}))&&Object.entries(N.inboundConnections[c]).forEach((function(t){var o=Object(j.a)(t,2),i=o[0],r=o[1].data.line,a=N.nodes[i].data.n.tokens.filter((function(n){return n.color==r.color}));n.push([a[e[i][r.color]].circle,r,c,i]),e[i][r.color]++}))})),n}function L(n,e,t){return F.apply(this,arguments)}function F(){return(F=Object(f.a)(l.a.mark((function n(e,t,c){return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n){var i=0,r=setInterval((function(){100==i&&(clearInterval(r),o.remove(e).renderAll(),o.bringToFront(N.nodes[c].data.node),n()),B(e,t,i++)}),40)})));case 1:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function K(){return(K=Object(f.a)(l.a.mark((function n(){var e,t;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e=V(),t=e.map((function(n){var e=Object(j.a)(n,3);e[0],e[1];return e[2]})).filter((function(n,e,t){return t.indexOf(n)==e})),0!=e.length){n.next=5;break}return n.abrupt("break",13);case 5:return n.next=7,Promise.all(e.map(function(){var n=Object(f.a)(l.a.mark((function n(e){var t,o,c,i,r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=Object(j.a)(e,4),o=t[0],c=t[1],i=t[2],r=t[3],n.next=3,L(o,c,i);case 3:N.nodes[r].data.n.removeToken(c.color);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()));case 7:return n.next=9,Promise.all(t.map((function(n){return Object.entries(N.connections[n]).map(function(){var e=Object(f.a)(l.a.mark((function e(t){var o,c,i,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Object(j.a)(t,2),c=o[0],i=o[1].data.line,r=_(i),e.next=4,L(r,i,n);case 4:return e.abrupt("return",[i.color,c]);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())})).flat());case 9:n.sent.forEach((function(n){var e=Object(j.a)(n,2),t=e[0],o=e[1];N.nodes[o].data.n.addToken(t)})),n.next=0;break;case 13:case"end":return n.stop()}}),n)})))).apply(this,arguments)}var U={initializeEvents:function(n){o=n;var e=D.objectNotSelected;o.on("mouse:down",(function(n){var t=n.target,o=n.pointer;t&&!t.node||(e=e.pass("down:".concat(t===c?"selected":t&&t.node?"node":"nothing"),{target:t,pointer:o}))})),o.on("mouse:move",(function(n){var t=n.pointer;e=e.pass("move:mouse",{pointer:t})})),o.on("object:moving",(function(n){var t=n.target,o=n.pointer;t&&!t.node||(e=e.pass("move:node",{target:t,pointer:o}))})),o.on("mouse:up",(function(n){var t=n.pointer;e=e.pass("up",{pointer:t}),document.onkeydown=function(n){S.push(n.key),e=e.pass("key:pressed",{key:n.key})},document.onkeyup=function(n){S=S.filter((function(e){return n.key!==e}))}}))}},z=t(1);function J(){Object(r.useEffect)((function(){var e=n();U.initializeEvents(e)}),[]);var n=function(){return new u.fabric.Canvas("canvas",{height:800,width:1600,backgroundColor:"white",selection:!1,preserveObjectStacking:!0})};return Object(z.jsxs)("div",{children:[Object(z.jsx)("h1",{children:"PETRI KOVALENKO+CHALIUK"}),Object(z.jsx)("h2",{children:"left click to create node (lc on current node to disable arrow)"}),Object(z.jsx)("h2",{children:"left click on other node while having arrow to connect"}),Object(z.jsx)("h2",{children:"create opposite arrow to disconnect"}),Object(z.jsx)("h2",{children:"left click + number on node while not having arrow to create colored arrow"}),Object(z.jsx)("h2",{children:"space click + number on node while having arrow to create colored token"}),Object(z.jsx)("h2",{children:"q - to start simulation"}),Object(z.jsx)("canvas",{id:"canvas"})]})}var G=function(){return Object(z.jsx)(J,{})};d.a.render(Object(z.jsx)(a.a.StrictMode,{children:Object(z.jsx)(G,{})}),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.5d5da5a6.chunk.js.map