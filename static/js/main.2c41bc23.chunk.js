(this["webpackJsonpgraph-project"]=this["webpackJsonpgraph-project"]||[]).push([[0],{19:function(n,t){function e(n){var t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}e.keys=function(){return[]},e.resolve=e,n.exports=e,e.id=19},20:function(n,t){},30:function(n,t){},31:function(n,t){},32:function(n,t){},36:function(n,t){},37:function(n,t){},38:function(n,t){},39:function(n,t){},40:function(n,t){},41:function(n,t){},43:function(n,t,e){"use strict";e.r(t);var o,i,c,a=e(7),r=e.n(a),s=e(21),d=e.n(s),u=e(3),h=e(5),l=e.n(h),f=e(12),v=e(14),b=e(13),p=e(0),j=(e(34),e(9)),M=e(8),g=e(4),k=e(1),y=function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;Object(k.a)(this,n),this.identifier=void 0,this.data=void 0,this.identifier=t,this.data=e},O=function n(t,e,o){Object(k.a)(this,n),this.node0=void 0,this.node1=void 0,this.data=void 0,this.node0=t,this.node1=e,this.data=o},x=function(n){Object(j.a)(e,n);var t=Object(M.a)(e);function e(){return Object(k.a)(this,e),t.apply(this,arguments)}return Object(g.a)(e,[{key:"createConnection",value:function(n,t,e){return new O(n,t,e)}}]),e}(function(){function n(){Object(k.a)(this,n),this.nodes={},this.connections={},this.inboundConnections={}}return Object(g.a)(n,[{key:"neighbours",value:function(n){var t=this.connections;if(!(n in t))return[];var e=[];for(var o in t[n])e.push(this.nodes[o]);return e}},{key:"connected",value:function(n,t){var e=this.connections;return n in e&&!!e[n][t]}},{key:"getConnection",value:function(n,t){var e=this.connections;return n in e?e[n][t]:null}},{key:"deleteV",value:function(n){var t=this.connections;n in this.nodes&&(delete this.nodes[n],delete t[n])}},{key:"addV",value:function(n){this.nodes[n.identifier]=n}},{key:"connect",value:function(n,t,e){n in this.nodes&&t in this.nodes&&(this.connections[t]=this.connections[t]||{},this.connections[n]=this.connections[n]||{},this.connections[n][t]=this.createConnection(this.nodes[n],this.nodes[t],e),this.inboundConnections[t]=this.inboundConnections[t]||{},this.inboundConnections[n]=this.inboundConnections[n]||{},this.inboundConnections[t][n]=this.connections[n][t])}},{key:"disconnect",value:function(n,t){var e=this.connections;n in e&&t in e[n]&&(delete this.connections[n][t],delete this.inboundConnections[t][n])}},{key:"contrapt",value:function(n,t){var e=this.connections,o=this.inboundConnections;if(n in e&&t in e[n]){for(var i in this.disconnect(n,t),this.disconnect(t,n),e[t])this.connect(n,i);for(var c in o[t])this.connect(c,n);this.deleteV(t)}}},{key:"GED",value:function(n){return 0}}]),n}()),C=(e(17),e(6),e(11)),w=1e3,m=function(n){Object(j.a)(e,n);var t=Object(M.a)(e);function e(n,o,i,c){var a;return Object(k.a)(this,e),(a=t.call(this,{radius:20,fill:"green",top:o-20,left:n-20,hasBorders:!1,hasControls:!1})).node=new y(w++,{x:n,y:o,n:Object(C.a)(a)}),i.addV(a.node),a.tokens=[],a.centreX=n,a.centreY=o,a.canvas=c,c.add(Object(C.a)(a)),a}return Object(g.a)(e,[{key:"addToken",value:function(){var n=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;6!=this.tokens.length&&(this.tokens.push({circle:new u.fabric.Circle({radius:5,fill:"rgb(".concat(17%t*30,",").concat(17%(+t+2)*30,",").concat(17%(+t+4)*30,")"),top:10,left:10}),color:t}),this._updateTokens(),this.tokens.forEach((function(t){var e=t.circle;return n.canvas.add(e)})))}},{key:"removeToken",value:function(n){var t=this.tokens.findIndex((function(t){var e=t.color;return n==e}));this.tokens=this.tokens.filter((function(n,e){return e!=t}))}},{key:"_updateTokens",value:function(){var n=this,t=function(n){var t=n.aCoords,e=t.tl,o=t.br;return[(e.x+o.x)/2,(e.y+o.y)/2]}(this),e=Object(p.a)(t,2),o=e[0],i=e[1];this.setCoords(),this.tokens.forEach((function(t,e){var c=t.circle;c.set({left:o-5+10*Math.sin(2*Math.PI*e/n.tokens.length),top:i-5+10*Math.cos(2*Math.PI*e/n.tokens.length)}).setCoords(),n.canvas.bringToFront(c),n.canvas.renderAll()}))}}]),e}(u.fabric.Circle),R=function(){function n(){Object(k.a)(this,n),this.handlers={}}return Object(g.a)(n,[{key:"on",value:function(n,t){var e=this;n.forEach((function(n){e.handlers[n]=t}))}},{key:"pass",value:function(n,t){return this.handlers[n]&&this.handlers[n](t)||this}}]),n}(),T=new x,N=0,S=[],E=function(n,t){var e=S.includes("a")?new u.fabric.Rect({width:40,height:40,fill:"red",top:t-20,left:n-20,hasBorders:!1,hasControls:!1}):new m(n,t,T,o);if(e.isRect=S.includes("a"),e.isRect){var i=new y(N++,{x:n,y:t,node:e});T.addV(i),e.node=i}return e.tokens=[],o.add(e),e},q=function(n,t){var e=Object(p.a)(n,4),i=e[0],c=e[1],a=e[2],r=e[3],s=new u.fabric.Triangle({width:10,height:15,fill:"rgb(".concat(17%t*30,",").concat(17%(+t+2)*30,",").concat(17%(+t+4)*30,")"),left:a,top:r,angle:180*Math.atan((a-i)/(r-c))/Math.PI,hasBorders:!1,hasas:!1,evented:!1,selectable:!1}),d=new u.fabric.Line([i,c,a,r],{stroke:"rgb(".concat(17%t*30,",").concat(17%(+t+2)*30,",").concat(17%(+t+4)*30,")"),hasBorders:!1,hasas:!1,evented:!1,selectable:!1});return d.triangle=s,d.color=t||0,o.add(d),o.add(s),d},I=function(n){var t=n.aCoords,e=t.tl,o=t.br;return[(e.x+o.x)/2,(e.y+o.y)/2]},P=function(){c&&(o.remove(c.triangle),o.remove(c).renderAll()),c=null},B=function(n){return[Math.floor(n.x)-2,Math.floor(n.y)-2]},A=function(n,t,e){var i=t.x1,c=t.x2,a=t.y1,r=t.y2,s=Math.sqrt((c-i)*(c-i)+(r-a)*(r-a))/100*e,d=Math.atan2(r-a,c-i);n.set({top:s*Math.sin(d)-5*Math.cos(d)+a,left:s*Math.cos(d)+5*Math.sin(d)+i}).setCoords(),o.renderAll()},D=["objectNotSelected","objectSelectedNode","objectDragging","ctrlPressed"].reduce((function(n,t){return n[t]=new R,n}),{});D.objectNotSelected.on(["down:nothing","down:node","down:selected"],(function(n){var t=n.pointer,e=n.target;return(i=e)||(i=E(Math.floor(t.x),Math.floor(t.y))),c=q([].concat(Object(b.a)(I(i)),[Math.floor(t.x)-2,Math.floor(t.y)-2]),S.find((function(n){return n>="0"&&n<="9"}))),D.objectSelectedNode})),D.objectSelectedNode.on(["down:nothing"],(function(n){n.target;var t=n.pointer;if(i.isRect&&!S.includes("a")||!i.isRect&&S.includes("a")){var e=E.apply(void 0,Object(b.a)(B(t))),a=I(e),r=Object(p.a)(a,2),s=r[0],d=r[1];c.end=e.node.identifier,c.set({x2:s,y2:d}).setCoords();var u=c.x1,h=c.y1,l=Math.atan2(d-h,s-u);c.triangle.set({left:s+5*Math.sin(l)-(c.isRect?(10*Math.sqrt(2)+15)*Math.cos(l):25*Math.cos(l)),top:d-5*Math.cos(l)-(c.isRect?(10*Math.sqrt(2)+15)*Math.sin(l):25*Math.sin(l)),angle:180*l/Math.PI+90}).setCoords(),T.connect(i.node.identifier,e.node.identifier,{line:c}),o.renderAll(),i=e,c=q([].concat(Object(b.a)(I(i)),[Math.floor(t.x)-2,Math.floor(t.y)-2]),S.find((function(n){return n>="0"&&n<="9"})))}})),D.objectSelectedNode.on(["down:node"],(function(n){var t=n.target;if(console.log(1),i.isRect&&!t.isRect||!i.isRect&&t.isRect){var e=I(t),a=Object(p.a)(e,2),r=a[0],s=a[1],d=t.node.identifier,u=i.node.identifier;if(T.connections[d]&&u in T.connections[d])return P(),o.remove(T.connections[d][u].data.line),o.remove(T.connections[d][u].data.line.triangle),T.disconnect(d,u),D.objectNotSelected;if(T.inboundConnections[d]&&u in T.inboundConnections[d])return P(),D.objectNotSelected;c.end=t.node.identifier,c.set({x2:r,y2:s}).setCoords();var h=c.x1,l=c.y1,f=Math.atan2(s-l,r-h);return c.triangle.set({left:r+5*Math.sin(f)-(c.isRect?(10*Math.sqrt(2)+15)*Math.cos(f):25*Math.cos(f)),top:s-5*Math.cos(f)-(c.isRect?(10*Math.sqrt(2)+15)*Math.sin(f):25*Math.sin(f)),angle:180*f/Math.PI+90}).setCoords(),o.renderAll(),T.connect(i.node.identifier,t.node.identifier,{line:c}),D.objectNotSelected}})),D.objectNotSelected.on(["key:pressed"],(function(n){"q"===n.key&&function(){J.apply(this,arguments)}()})),D.objectSelectedNode.on(["key:pressed"],(function(n){" "===n.key&&i.addToken&&i.addToken(S.find((function(n){return n>="0"&&n<="9"})))})),D.objectSelectedNode.on(["down:selected"],(function(){return P(),D.objectNotSelected})),D.objectSelectedNode.on(["move:mouse"],(function(n){var t=n.pointer,e=B(t),i=Object(p.a)(e,2),a=i[0],r=i[1];c.set({x2:a,y2:r}).setCoords();var s=c.x1,d=c.y1,u=Math.atan2(r-d,a-s);c.triangle.set({left:a+5*Math.sin(u),top:r-5*Math.cos(u),angle:180*u/Math.PI+90}).setCoords(),o.sendToBack(c).renderAll()})),D.objectSelectedNode.on(["move:node"],(function(){return D.objectDragging})),D.objectNotSelected.on(["move:node"],(function(){return D.objectDragging})),D.objectDragging.on(["move:node"],(function(n){var t=n.target,e=n.pointer;P();var i=t.node.identifier;if(t._updateTokens&&t._updateTokens(),o.sendToBack(t),T.connections[i]||T.inboundConnections[i]){var c=B(e),a=Object(p.a)(c,2),r=a[0],s=a[1];Object.entries(Object(v.a)(Object(v.a)({},T.connections[i]),T.inboundConnections[i])).forEach((function(n){var t=Object(p.a)(n,2),e=(t[0],t[1].data.line);e.set(e.end===i?{x2:r,y2:s}:{x1:r,y1:s}).setCoords();var c=e.end===i?e.x1:e.x2,a=e.end===i?e.y1:e.y2,d=Math.atan2(s-a,r-c);e.triangle.set({left:e.end===i?r+5*Math.sin(d)-(e.isRect?(10*Math.sqrt(2)+15)*Math.cos(d-Math):25*Math.cos(d)):c-5*Math.sin(d)+(e.isRect?(10*Math.sqrt(2)+15)*Math.cos(d-Math):25*Math.cos(d)),top:e.end===i?s-5*Math.cos(d)-(e.isRect?(10*Math.sqrt(2)+15)*Math.sin(d):25*Math.sin(d)):a+5*Math.cos(d)+(e.isRect?(10*Math.sqrt(2)+15)*Math.sin(d):25*Math.sin(d)),angle:e.end===i?180*d/Math.PI+90:180*d/Math.PI-90}).setCoords(),o.sendToBack(e),o.sendToBack(e.triangle)})),o.renderAll()}})),D.objectDragging.on(["up"],(function(){var n=i.node.identifier,t=Object(b.a)(I(i)),e=t[0],c=t[1];return T.connections[n]?(Object.entries(Object(v.a)(Object(v.a)({},T.connections[n]),T.inboundConnections[n])).forEach((function(t){var i=Object(p.a)(t,2),a=(i[0],i[1].data.line);a.set(a.end===n?{x2:e,y2:c}:{x1:e,y1:c}).setCoords(),o.sendToBack(a),a.set(a.end===n?{x2:e,y2:c}:{x1:e,y1:c}).setCoords();var r=a.end===n?a.x1:a.x2,s=a.end===n?a.y1:a.y2,d=Math.atan2(c-s,e-r);a.triangle.set({left:a.end===n?e+5*Math.sin(d)-(a.isRect?(10*Math.sqrt(2)+15)*Math.cos(d-Math):25*Math.cos(d)):r-5*Math.sin(d)+(a.isRect?(10*Math.sqrt(2)+15)*Math.cos(d-Math):25*Math.cos(d)),top:a.end===n?c-5*Math.cos(d)-(a.isRect?(10*Math.sqrt(2)+15)*Math.sin(d):25*Math.sin(d)):s+5*Math.cos(d)+(a.isRect?(10*Math.sqrt(2)+15)*Math.sin(d):25*Math.sin(d)),angle:a.end===n?180*d/Math.PI+90:180*d/Math.PI-90}).setCoords(),o.sendToBack(a.triangle)})),i._updateTokens&&i._updateTokens(),o.renderAll(),D.objectNotSelected):D.objectNotSelected}));var _=function(n){var t=n.color,e=new u.fabric.Circle({radius:5,fill:"rgb(".concat(17%t*30,",").concat(17%(+t+2)*30,",").concat(17%(+t+4)*30,")"),top:n.y1,left:n.x1});return o.add(e),e};function V(){var n=[],t={};return Object.entries(T.nodes).filter((function(n){var t=Object(p.a)(n,2);t[0];return!t[1].data.n})).forEach((function(e){var o=Object(p.a)(e,2),i=o[0];o[1];console.log(Object.entries(T.inboundConnections[i])),Object.entries(T.inboundConnections[i]).every((function(n){var e=Object(p.a)(n,2),o=e[0],i=e[1].data.line,c=T.nodes[o].data.n.tokens.filter((function(n){return n.color==i.color}));return t[o]||(t[o]=[0,0,0,0,0,0,0,0,0,0]),c.length-1>=t[o][i.color]}))&&Object.entries(T.inboundConnections[i]).forEach((function(e){var o=Object(p.a)(e,2),c=o[0],a=o[1].data.line,r=T.nodes[c].data.n.tokens.filter((function(n){return n.color==a.color}));n.push([r[t[c][a.color]].circle,a,i,c]),t[c][a.color]++}))})),n}function F(n,t,e){return z.apply(this,arguments)}function z(){return(z=Object(f.a)(l.a.mark((function n(t,e,i){return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n){var c=0,a=setInterval((function(){100==c&&(clearInterval(a),o.remove(t).renderAll(),o.bringToFront(T.nodes[i].data.node),n()),A(t,e,c++)}),40)})));case 1:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function J(){return(J=Object(f.a)(l.a.mark((function n(){var t,e;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=V(),e=t.map((function(n){var t=Object(p.a)(n,3);t[0],t[1];return t[2]})).filter((function(n,t,e){return e.indexOf(n)==t})),0!=t.length){n.next=5;break}return n.abrupt("break",13);case 5:return n.next=7,Promise.all(t.map(function(){var n=Object(f.a)(l.a.mark((function n(t){var e,o,i,c,a;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e=Object(p.a)(t,4),o=e[0],i=e[1],c=e[2],a=e[3],n.next=3,F(o,i,c);case 3:T.nodes[a].data.n.removeToken(i.color);case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()));case 7:return n.next=9,Promise.all(e.map((function(n){return Object.entries(T.connections[n]).map(function(){var t=Object(f.a)(l.a.mark((function t(e){var o,i,c,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Object(p.a)(e,2),i=o[0],c=o[1].data.line,a=_(c),t.next=4,F(a,c,n);case 4:return t.abrupt("return",[c.color,i]);case 5:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}())})).flat());case 9:n.sent.forEach((function(n){var t=Object(p.a)(n,2),e=t[0],o=t[1];T.nodes[o].data.n.addToken(e)})),n.next=0;break;case 13:case"end":return n.stop()}}),n)})))).apply(this,arguments)}var L={initializeEvents:function(n){o=n;var t=D.objectNotSelected;o.on("mouse:down",(function(n){var e=n.target,o=n.pointer;e&&!e.node||(t=t.pass("down:".concat(e===i?"selected":e&&e.node?"node":"nothing"),{target:e,pointer:o}))})),o.on("mouse:move",(function(n){var e=n.pointer;t=t.pass("move:mouse",{pointer:e})})),o.on("object:moving",(function(n){var e=n.target,o=n.pointer;e&&!e.node||(t=t.pass("move:node",{target:e,pointer:o}))})),o.on("mouse:up",(function(n){var e=n.pointer;t=t.pass("up",{pointer:e}),document.onkeydown=function(n){S.push(n.key),t=t.pass("key:pressed",{key:n.key})},document.onkeyup=function(n){S=S.filter((function(t){return n.key!==t}))}}))}},U=e(2);function G(){Object(a.useEffect)((function(){var t=n();L.initializeEvents(t)}),[]);var n=function(){return new u.fabric.Canvas("canvas",{height:800,width:1600,backgroundColor:"white",selection:!1,preserveObjectStacking:!0})};return Object(U.jsxs)("div",{children:[Object(U.jsx)("h1",{children:"Fabric.js on React - fabric.Canvas('...')"}),Object(U.jsx)("canvas",{id:"canvas"})]})}var X=function(){return Object(U.jsx)(G,{})};d.a.render(Object(U.jsx)(r.a.StrictMode,{children:Object(U.jsx)(X,{})}),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.2c41bc23.chunk.js.map